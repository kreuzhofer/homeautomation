@model IEnumerable<W10Home.DevicePortal.IotHub.DeviceData>

@{
    ViewBag.Title = "Devices";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script language="javascript">
    function opensendmessagedialog(id) {
        bootbox.prompt({
            title: "Enter message for this device",
            inputType: "textarea",
            callback: function(result) {
                if (result != null) {
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("SendMessage", "Device")',
                        data: { id: id, message: result },
                        cache: false,
                        success: function (data) { alert(data); },
                        error: function (){ alert("error"); }
                    });
                }
            }});
    }
</script>

<h2>Devices</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Id)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.ConnectionState)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.LastActivityTime)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.LastConnectionStateUpdatedTime)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.LastStateUpdatedTime)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.MessageCount)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.State)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.SuspensionReason)
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.Id)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.ConnectionState)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.LastActivityTime)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.LastConnectionStateUpdatedTime)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.LastStateUpdatedTime)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.MessageCount)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.State)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.SuspensionReason)
        </td>
        <td>
            @Html.ActionLink("Edit", "Edit", new { id=item.Id }) |
            @Html.ActionLink("Details", "Details", new { id=item.Id }) |
            @Html.ActionLink("Delete", "Delete", new { id=item.Id }, new { onclick="return confirm('Are you sure?');" })
            <a href="#" onclick="opensendmessagedialog('@item.Id'); return false;">Send Message</a>
        </td>
    </tr>
}

</table>
